// Generated by CoffeeScript 1.6.3
(function() {
  this.Reservation = (function() {
    function Reservation() {}

    Reservation.reserve = function(app_item_id, options) {
      return $.ajax("/reservations", {
        type: 'post',
        data: {
          reservation: {
            app_item_id: app_item_id
          }
        },
        statusCode: {
          200: function(response) {
            return Reservation.showSuccessDialog();
          },
          408: function(response) {
            return AuthDialog.show('この機能を利用するにはログインが必要です。');
          }
        }
      });
    };

    Reservation.showSuccessDialog = function() {
      var source;
      source = "";
      source += "<div class='reservation-result'>";
      source += "  <div class='reservation-success-text'>予約が完了しました！</div>";
      source += "  <a class='btn btn-default check-reservation-btn'>予約の詳細を確認する</div>";
      source += "</div>";
      return bootbox.alert(source);
    };

    return Reservation;

  })();

  this.AppItemShow = (function() {
    function AppItemShow() {}

    AppItemShow.showConfirmReservationDialog = function(success_callback) {
      var source, title;
      title = ($('.app-title')).text();
      source = "";
      source += "<div class='reservation-form-wrapper'>";
      source += "  <form action='/reservations' class='reservation-form'>";
      source += "    <input type='hidden' name='app_item_id' value='" + gon.app_item_id + "'>";
      source += "    <input type='submit' value='予約する' class='btn btn-default btn-reservation'>";
      source += "  </form>";
      source += "  <p class='notice'>※予約の取り消しはできませんので、</br>ご注意下さい。<p>";
      source += "</div>";
      return bootbox.dialog({
        message: source,
        title: "<b>" + title + "</b> を予約しますか？"
      });
    };

    AppItemShow.registerCallback = function() {
      var callback;
      callback = function() {
        if (gon.user_id != null) {
          return AppItemShow.showConfirmReservationDialog(function() {
            return Reservation.reserve(gon.app_item_id);
          });
        } else {
          return AuthDialog.show('この機能を利用するにはログインが必要です。');
        }
      };
      return ($('.reservation-btn')).click(callback);
    };

    return AppItemShow;

  })();

  $(document).on('ready page:load', function() {
    var $frame, $wrap;
    if (URLHelper.isAppUrl(location.href)) {
      AppItemShow.registerCallback();
      $frame = $("#effects");
      $wrap = $frame.parent();
      return $frame.sly({
        horizontal: 1,
        itemNav: "forceCentered",
        smart: 1,
        activateMiddle: 1,
        activateOn: "click",
        mouseDragging: 1,
        touchDragging: 1,
        releaseSwing: 1,
        startAt: 0,
        scrollBar: $wrap.find(".scrollbar"),
        scrollBy: 1,
        speed: 300,
        elasticBounds: 1,
        easing: "swing",
        dragHandle: 1,
        dynamicHandle: 1,
        clickBar: 1
      });
    }
  });

}).call(this);
